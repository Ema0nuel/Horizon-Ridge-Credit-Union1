import{u as G,r as o,s as N,j as e,a as M}from"./index-BaOxJvox.js";import{U as J}from"./UserHeader-Cw37___K.js";import{h as K}from"./authService-2v3OOyD4.js";import"./api-CBahbCmN.js";const Q=({type:n})=>{const a={personal:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),business:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"})}),education:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C6.5 6.253 2 10.998 2 17.25m20-11.002c5.5 3.5 9 8.25 9 11.002M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})};return e.jsx("div",{className:"text-basic",children:a[n]||null})},X=({status:n})=>{const a={pending:{bg:"bg-yellow-100",text:"text-yellow-800",label:"Pending Approval"},approved:{bg:"bg-green-100",text:"text-green-800",label:"Approved"},rejected:{bg:"bg-red-100",text:"text-red-800",label:"Rejected"},completed:{bg:"bg-blue-100",text:"text-blue-800",label:"Completed"}},l=a[n]||a.pending;return e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-semibold ${l.bg} ${l.text}`,children:l.label})},Z=({type:n,title:a,description:l,minAmount:h,maxAmount:f,isSelected:i,onClick:j})=>e.jsxs("button",{onClick:j,className:`flex flex-col items-start gap-3 p-4 sm:p-6 rounded-sm border transition-all active:scale-95 w-full text-left ${i?"border-basic bg-primary shadow-lg":"border-secondary bg-primary hover:border-basic hover:shadow-md"}`,"aria-pressed":i,children:[e.jsx("div",{className:"text-basic",children:e.jsx(Q,{type:n})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-secondary text-base",children:a}),e.jsx("p",{className:"text-xs text-secondary opacity-70 mt-1",children:l}),e.jsxs("p",{className:"text-xs text-basic font-semibold mt-2",children:[h," - ",f]})]}),i&&e.jsx("div",{className:"ml-auto text-basic font-bold",children:"✔️"})]}),y=({label:n,name:a,type:l="text",value:h,onChange:f,placeholder:i,required:j=!1,error:d,disabled:u=!1,options:v=null})=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-secondary mb-2 uppercase tracking-wider opacity-80",children:[n,j&&e.jsx("span",{className:"text-red-600 ml-1",children:"*"})]}),v?e.jsxs("select",{name:a,value:h,onChange:f,disabled:u,className:`w-full px-4 py-3 border rounded-sm focus:outline-none focus:ring-2 transition-all font-sans ${d?"border-red-500 focus:ring-red-500 focus:ring-opacity-50":"border-secondary focus:ring-basic focus:ring-opacity-30"} ${u?"bg-gray-100 opacity-50 cursor-not-allowed":"bg-primary"}`,children:[e.jsxs("option",{value:"",children:["Select ",n.toLowerCase()]}),v.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))]}):e.jsx("input",{type:l,name:a,value:h,onChange:f,placeholder:i,disabled:u,className:`w-full px-4 py-3 border rounded-sm focus:outline-none focus:ring-2 transition-all font-sans ${d?"border-red-500 focus:ring-red-500 focus:ring-opacity-50":"border-secondary focus:ring-basic focus:ring-opacity-30"} ${u?"bg-gray-100 opacity-50 cursor-not-allowed":"bg-primary"}`}),d&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:d})]}),ee=({isOpen:n,loan:a,onClose:l})=>!n||!a?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary shadow-2xl max-w-md w-full max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"bg-basic text-primary p-6 text-center",children:[e.jsx("div",{className:"text-5xl mb-3"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Summit Ridge Credit Union"}),e.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Loan Application Receipt"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"text-center py-3 bg-yellow-50 border border-yellow-200 rounded-sm",children:e.jsx("p",{className:"text-sm font-semibold text-yellow-800",children:"Pending Admin Review"})}),e.jsxs("div",{className:"space-y-3 text-sm border-b border-secondary pb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-secondary opacity-70",children:"Reference:"}),e.jsx("span",{className:"font-mono font-semibold text-secondary",children:a.reference_number})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-secondary opacity-70",children:"Date:"}),e.jsx("span",{className:"font-semibold text-secondary",children:new Date(a.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-secondary opacity-70",children:"Type:"}),e.jsx("span",{className:"font-semibold text-secondary capitalize",children:a.metadata?.loan_type||"Personal"})]})]}),e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-xs text-secondary opacity-70 mb-1",children:"Requested Amount"}),e.jsxs("p",{className:"text-3xl font-bold text-basic",children:[a.currency," ",parseFloat(a.amount).toFixed(2)]})]}),a.description&&e.jsxs("div",{className:"text-sm border-t border-secondary pt-4",children:[e.jsx("p",{className:"text-secondary opacity-70 font-medium mb-1",children:"Purpose"}),e.jsx("p",{className:"text-secondary",children:a.description})]}),e.jsx("div",{className:"bg-blue-50 rounded-sm p-4 border border-blue-200",children:e.jsx("p",{className:"text-blue-900 text-xs font-semibold",children:"â„¹ï¸ Your loan application has been submitted. We will review it within 1-2 business days."})})]}),e.jsx("div",{className:"bg-gray-50 p-4 border-t border-secondary text-center",children:e.jsx("button",{onClick:l,className:"w-full py-2 px-4 bg-basic text-primary font-semibold rounded-sm hover:bg-opacity-90 transition-all active:scale-95",children:"Close"})})]})});function re(){const n=G(),[a,l]=o.useState(null),[h,f]=o.useState(null),[i,j]=o.useState([]),[d,u]=o.useState([]),[v,g]=o.useState(!0),[w,k]=o.useState("apply"),[F,D]=o.useState("personal"),[P,L]=o.useState(!1),[z,I]=o.useState(!1),[O,B]=o.useState(null),[t,S]=o.useState({loanType:"personal",targetAccountId:"",loanAmount:"",loanTerm:"12",purpose:"",employmentStatus:"employed",annualIncome:"",employerName:""}),[m,_]=o.useState({}),[T,A]=o.useState({type:"",text:""}),[$,q]=o.useState(!1);o.useEffect(()=>{let s=!0;return(async()=>{try{const{data:{session:r}={}}=await N.auth.getSession(),c=r?.user?.id;if(!c){n("/auth/login",{replace:!0});return}l(c);const{data:p}=await N.from("user_profiles").select("*").eq("id",c).eq("is_deleted",!1).maybeSingle(),{data:x}=await N.from("accounts").select("*").eq("user_id",c).eq("is_deleted",!1).order("created_at",{ascending:!1}),{data:V}=await N.from("transactions").select("*").eq("transaction_type","loan").in("from_account_id",(x||[]).map(C=>C.id)).order("created_at",{ascending:!1});s&&(f(p),j(x||[]),u(V||[]),x?.length>0&&S(C=>({...C,targetAccountId:x[0].id})))}catch(r){console.error("[LOAN] Load error:",r),A({type:"error",text:"Failed to load data"})}finally{s&&g(!1)}})(),()=>{s=!1}},[n]);const b=s=>{const{name:r,value:c}=s.target;S(p=>({...p,[r]:c})),m[r]&&_(p=>({...p,[r]:""}))},U=()=>{const s={};return t.targetAccountId||(s.targetAccountId="Select target account"),(!t.loanAmount||parseFloat(t.loanAmount)<=0)&&(s.loanAmount="Enter valid loan amount"),parseFloat(t.loanAmount)>1e5&&(s.loanAmount="Loan amount cannot exceed 100,000"),t.loanTerm||(s.loanTerm="Select loan term"),t.purpose||(s.purpose="Enter loan purpose"),(!t.annualIncome||parseFloat(t.annualIncome)<=0)&&(s.annualIncome="Enter valid annual income"),t.employmentStatus==="employed"&&!t.employerName&&(s.employerName="Enter employer name"),_(s),Object.keys(s).length===0},H=async s=>{if(s.preventDefault(),!!U()){q(!0),A({type:"",text:""});try{const r=i.find(x=>x.id===t.targetAccountId);if(!r)throw new Error("Target account not found");const{data:c,error:p}=await N.from("transactions").insert([{from_account_id:t.targetAccountId,to_account_id:t.targetAccountId,amount:parseFloat(t.loanAmount),currency:r.currency||"EUR",transaction_type:"loan",status:"pending",description:`Loan Request: ${t.purpose}`,reference_number:`LOAN-${Date.now()}-${Math.random().toString(36).substr(2,9).toUpperCase()}`,initiated_by_user_id:a,metadata:{loan_type:t.loanType,loan_term:t.loanTerm,purpose:t.purpose,employment_status:t.employmentStatus,annual_income:t.annualIncome,employer_name:t.employerName}}]).select("*").single();if(p)throw p;B(c),L(!1),I(!0),u(x=>[c,...x]),A({type:"success",text:`Loan request submitted! Reference: ${c.reference_number}`}),S({loanType:"personal",targetAccountId:i[0]?.id||"",loanAmount:"",loanTerm:"12",purpose:"",employmentStatus:"employed",annualIncome:"",employerName:""})}catch(r){console.error("[LOAN] request error:",r),A({type:"error",text:r.message||"Failed to submit loan request"})}finally{q(!1)}}};if(v)return e.jsx("div",{className:"min-h-screen bg-primary flex items-center justify-center",children:e.jsx(M,{size:"lg"})});if(!a)return null;const E=[{type:"personal",title:"Personal Loan",desc:"For personal expenses",min:"$1,000",max:"$50,000"},{type:"business",title:"Business Loan",desc:"For business growth",min:"$5,000",max:"$100,000"},{type:"education",title:"Education Loan",desc:"For educational needs",min:"$2,000",max:"$75,000"}],W=i.map(s=>({value:s.id,label:`${s.account_number} - ${s.currency} ${parseFloat(s.balance||0).toFixed(2)}`})),R=[{value:"6",label:"6 Months"},{value:"12",label:"12 Months"},{value:"24",label:"24 Months"},{value:"36",label:"36 Months"},{value:"60",label:"60 Months"}],Y=[{value:"employed",label:"Employed"},{value:"self-employed",label:"Self-Employed"},{value:"retired",label:"Retired"},{value:"student",label:"Student"}];return e.jsxs("div",{className:"min-h-screen bg-primary",children:[e.jsx(J,{handleSignOut:()=>K(n),profile:h}),e.jsxs("main",{className:"container mx-auto max-w-6xl px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6 flex items-center gap-2 text-xs sm:text-sm text-secondary opacity-70",children:[e.jsx("button",{onClick:()=>n("/dashboard"),className:"hover:opacity-100 font-bold",children:"< Dashboard"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"font-semibold opacity-100",children:"Loan"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-secondary mb-2",children:"Loan Management"}),e.jsx("p",{className:"text-sm sm:text-base text-secondary opacity-70",children:"Request a loan or view your loan history"})]}),T.text&&e.jsx("div",{className:`mb-6 p-4 sm:p-6 rounded-sm border-l-4 ${T.type==="success"?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800"}`,children:e.jsx("p",{className:"text-sm font-semibold",children:T.text})}),e.jsxs("div",{className:"mb-8 flex gap-3 border-b border-secondary",children:[e.jsx("button",{onClick:()=>k("apply"),className:`py-3 px-6 font-semibold text-sm transition-all border-b-2 ${w==="apply"?"text-basic border-basic":"text-secondary opacity-70 border-transparent hover:opacity-100"}`,children:"Apply for Loan"}),e.jsxs("button",{onClick:()=>k("history"),className:`py-3 px-6 font-semibold text-sm transition-all border-b-2 ${w==="history"?"text-basic border-basic":"text-secondary opacity-70 border-transparent hover:opacity-100"}`,children:["Loan History (",d.length,")"]})]}),w==="apply"&&e.jsx("div",{children:P?e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary shadow-md p-6 sm:p-8 max-w-2xl",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-secondary mb-6",children:[E.find(s=>s.type===F)?.title," ","Application"]}),e.jsxs("form",{onSubmit:H,children:[e.jsx(y,{label:"Credit to Account",name:"targetAccountId",value:t.targetAccountId,onChange:b,required:!0,error:m.targetAccountId,options:W}),e.jsx(y,{label:"Loan Amount",name:"loanAmount",type:"number",step:"100",value:t.loanAmount,onChange:b,placeholder:"e.g., 5000",required:!0,error:m.loanAmount}),e.jsx(y,{label:"Loan Term",name:"loanTerm",value:t.loanTerm,onChange:b,required:!0,error:m.loanTerm,options:R}),e.jsx(y,{label:"Loan Purpose",name:"purpose",value:t.purpose,onChange:b,placeholder:"e.g., Home renovation, Car purchase",required:!0,error:m.purpose}),e.jsx(y,{label:"Employment Status",name:"employmentStatus",value:t.employmentStatus,onChange:b,required:!0,error:m.employmentStatus,options:Y}),e.jsx(y,{label:"Annual Income",name:"annualIncome",type:"number",step:"1000",value:t.annualIncome,onChange:b,placeholder:"e.g., 50000",required:!0,error:m.annualIncome}),t.employmentStatus==="employed"&&e.jsx(y,{label:"Employer Name",name:"employerName",value:t.employerName,onChange:b,placeholder:"Your current employer",required:!0,error:m.employerName}),e.jsxs("div",{className:"mb-6 p-4 sm:p-6 rounded-sm border border-secondary bg-primary shadow-sm space-y-4",children:[e.jsx("h4",{className:"font-semibold text-secondary text-base",children:"Summary"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between pb-3 border-b border-secondary opacity-70",children:[e.jsx("span",{className:"text-secondary",children:"Loan Type:"}),e.jsx("span",{className:"font-semibold text-secondary capitalize",children:t.loanType})]}),e.jsxs("div",{className:"flex justify-between pb-3 border-b border-secondary opacity-70",children:[e.jsx("span",{className:"text-secondary",children:"Amount:"}),e.jsxs("span",{className:"font-semibold text-basic text-lg",children:["$",parseFloat(t.loanAmount||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between pb-3 border-b border-secondary opacity-70",children:[e.jsx("span",{className:"text-secondary",children:"Term:"}),e.jsx("span",{className:"font-semibold text-secondary",children:R.find(s=>s.value===t.loanTerm)?.label})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-secondary",children:"Purpose:"}),e.jsx("span",{className:"font-semibold text-secondary",children:t.purpose})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{L(!1),_({})},className:"flex-1 py-3 px-6 border border-secondary text-secondary font-semibold rounded-sm hover:bg-gray-50 transition-all active:scale-95",children:"Back"}),e.jsx("button",{type:"submit",disabled:$,className:"flex-1 py-3 px-6 bg-basic text-primary font-semibold rounded-sm hover:bg-opacity-90 disabled:opacity-50 transition-all active:scale-95 flex items-center justify-center gap-2",children:$?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:"sm"})," Submitting..."]}):"Submit Loan Request"})]})]})]}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-secondary mb-6",children:"Select Loan Type"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:E.map(s=>e.jsx(Z,{type:s.type,title:s.title,description:s.desc,minAmount:s.min,maxAmount:s.max,isSelected:F===s.type,onClick:()=>{D(s.type),S(r=>({...r,loanType:s.type})),L(!0)}},s.type))})]})}),w==="history"&&e.jsx("div",{children:d.length>0?e.jsx("div",{className:"space-y-4",children:d.map(s=>e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary p-4 sm:p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-70 uppercase tracking-wider font-semibold mb-1",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("p",{className:"font-mono font-semibold text-secondary",children:s.reference_number})]}),e.jsx(X,{status:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-secondary opacity-70 mb-1 text-xs",children:"Type"}),e.jsx("p",{className:"font-semibold text-secondary capitalize",children:s.metadata?.loan_type||"Loan"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-secondary opacity-70 mb-1 text-xs",children:"Amount"}),e.jsxs("p",{className:"font-bold text-basic",children:[s.currency," ",parseFloat(s.amount).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-secondary opacity-70 mb-1 text-xs",children:"Term"}),e.jsxs("p",{className:"font-semibold text-secondary",children:[s.metadata?.loan_term," months"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-secondary opacity-70 mb-1 text-xs",children:"Purpose"}),e.jsx("p",{className:"font-semibold text-secondary truncate",children:s.metadata?.purpose||"N/A"})]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-16 bg-gray-50 rounded-sm border border-secondary",children:[e.jsx("p",{className:"text-lg text-secondary opacity-70 mb-2",children:"No loan applications"}),e.jsx("p",{className:"text-sm text-secondary opacity-50",children:'Click "Apply for Loan" to submit your first application'})]})})]}),e.jsx(ee,{isOpen:z,loan:O,onClose:()=>{I(!1)}})]})}export{re as LoanPage,re as default};
