import{u as b,r as o,s as P}from"./index-DvGZ9O-H.js";import{a}from"./authService-av9k-sGG.js";function I(){const[f,l]=o.useState(null),[U,i]=o.useState(null),[A,g]=o.useState([]),[S,n]=o.useState(!1),[m,s]=o.useState(null);o.useEffect(()=>{(async()=>{try{const e=await a.getSession();if(e?.user?.id){l(e.user);const c=await a.getUserProfile(e.user.id);i(c);const u=await a.getUserAccounts(e.user.id);g(u),console.log("[USEAUTH] Init complete - user:",e.user.id)}}catch(e){console.error("[USEAUTH] Init error:",e.message),s(e.message)}})();const{data:{subscription:t}}=P.auth.onAuthStateChange(async(e,c)=>{if(console.log("[USEAUTH] Auth state changed:",e),e==="SIGNED_OUT")l(null),i(null),g([]),s(null);else if(c?.user?.id){l(c.user);try{const u=await a.getUserProfile(c.user.id);i(u);const h=await a.getUserAccounts(c.user.id);g(h),console.log("[USEAUTH] Subscription update complete")}catch(u){console.error("[USEAUTH] State change error:",u.message),s(u.message)}}});return()=>t?.unsubscribe()},[]);const p=o.useCallback(async(r,t)=>{n(!0),s(null);try{const e=await a.signInWithAccountNumber(r,t);l(e.user),console.log("[USEAUTH] signIn - user set immediately:",e.user.id);const c=await a.getUserProfile(e.user.id);i(c),console.log("[USEAUTH] signIn - profile loaded");const u=await a.getUserAccounts(e.user.id);return g(u),console.log("[USEAUTH] signIn - accounts loaded"),e}catch(e){throw console.error("[USEAUTH] signIn error:",e.message),s(e.message),e}finally{n(!1)}},[]),w=o.useCallback(async(r,t,e,c,u,h,H)=>{n(!0),s(null);try{return await a.signUp(r,t,e,c,u,h,H)}catch(d){throw console.error("[USEAUTH] signUp error:",d.message),s(d.message),d}finally{n(!1)}},[]),y=o.useCallback(async r=>{n(!0),s(null);try{await a.resetPasswordRequest(r)}catch(t){throw console.error("[USEAUTH] resetPasswordRequest error:",t.message),s(t.message),t}finally{n(!1)}},[]),E=o.useCallback(async r=>{n(!0),s(null);try{await a.updatePassword(r)}catch(t){throw console.error("[USEAUTH] updatePassword error:",t.message),s(t.message),t}finally{n(!1)}},[]),T=o.useCallback(async()=>{n(!0),s(null);try{await a.signOut(),l(null),i(null),g([]),console.log("[USEAUTH] signOut complete")}catch(r){throw console.error("[USEAUTH] signOut error:",r.message),s(r.message),r}finally{n(!1)}},[]);return{user:f,profile:U,accounts:A,loading:S,error:m,signIn:p,signUp:w,resetPasswordRequest:y,updatePassword:E,signOut:T}}function k(f){const{user:l,loading:U}=I(),i=b();o.useEffect(()=>{U||l&&i("/dashboard",{replace:!0})},[f,l,U,i])}export{I as a,k as u};
