import{u as U,r as f,s as w,j as e,a as S}from"./index-C7IEQRLs.js";import{U as z}from"./UserHeader-K6QWOYdA.js";import{h as P}from"./authService-D5WlTTbB.js";import"./api-CBahbCmN.js";const I=()=>e.jsx("svg",{className:"w-24 h-24",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),M=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),q=({name:t})=>({account:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"})}),settings:e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),risk:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),status:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})[t]||null,k=({label:t,name:x,type:u="text",value:c,onChange:o,placeholder:d,disabled:n=!1,error:p,required:g=!1})=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-secondary mb-2 uppercase tracking-wider opacity-80",children:[t,g&&e.jsx("span",{className:"text-red-600 ml-1",children:"*"})]}),e.jsx("input",{type:u,name:x,value:c,onChange:o,placeholder:d,disabled:n,className:`w-full px-4 py-3 border rounded-sm focus:outline-none focus:ring-2 transition-all font-sans ${p?"border-red-500 focus:ring-red-500 focus:ring-opacity-50":"border-secondary focus:ring-basic focus:ring-opacity-30"} ${n?"bg-gray-100 opacity-50 cursor-not-allowed":"bg-primary"}`}),p&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:p})]}),T=({accounts:t,loading:x,onSuspendAccount:u,onReactivateAccount:c,submitting:o,selectedAccountId:d})=>{const[n,p]=f.useState(null),[g,v]=f.useState(""),[h,l]=f.useState({type:"",text:""});if(x)return e.jsx(S,{size:"md"});if(!t||t.length===0)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-secondary opacity-70",children:"No accounts found"})});const m=async a=>{if(!g.trim()){l({type:"error",text:"Please provide a reason"});return}try{await u(a,g),l({type:"success",text:"Account suspended successfully"}),p(null),v("")}catch(b){l({type:"error",text:b?.message||"Failed to suspend account"})}},y=async a=>{try{await c(a),l({type:"success",text:"Account reactivated successfully"})}catch(b){l({type:"error",text:b?.message||"Failed to reactivate account"})}};return e.jsxs("div",{className:"space-y-6",children:[h.text&&e.jsx("div",{className:`p-4 rounded-sm border-l-4 ${h.type==="success"?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800"}`,children:e.jsx("p",{className:"text-sm font-semibold",children:h.text})}),t.map(a=>e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary p-6 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 pb-6 border-b border-secondary",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Account Number"}),e.jsx("p",{className:"text-lg font-bold text-secondary font-mono mt-2",children:a.account_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Account Type"}),e.jsx("p",{className:"text-lg font-semibold text-secondary capitalize mt-2",children:a.account_type})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 pb-6 border-b border-secondary",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Currency"}),e.jsx("p",{className:"text-lg font-semibold text-secondary mt-2",children:a.currency})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Status"}),e.jsx("p",{className:`text-lg font-semibold capitalize mt-2 ${a.status==="active"?"text-green-600":a.status==="frozen"?"text-yellow-600":a.status==="suspended"?"text-red-600":"text-gray-600"}`,children:a.status})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 pb-6 border-b border-secondary",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Balance"}),e.jsxs("p",{className:"text-xl font-bold text-basic mt-2",children:[a.currency," ",parseFloat(a.balance||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Available Balance"}),e.jsxs("p",{className:"text-xl font-bold text-basic mt-2",children:[a.currency," ",parseFloat(a.available_balance||a.balance||0).toFixed(2)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 pb-6 border-b border-secondary",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Daily Limit"}),e.jsxs("p",{className:"text-lg font-semibold text-secondary mt-2",children:[a.currency," ",parseFloat(a.daily_transaction_limit||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Monthly Limit"}),e.jsxs("p",{className:"text-lg font-semibold text-secondary mt-2",children:[a.currency," ",parseFloat(a.monthly_transaction_limit||0).toFixed(2)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 pb-6 border-b border-secondary",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"IBAN"}),e.jsx("p",{className:"text-sm font-mono text-secondary mt-2",children:a.iban||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"SWIFT Code"}),e.jsx("p",{className:"text-sm font-mono text-secondary mt-2",children:a.swift_code||"Not provided"})]})]}),e.jsx("div",{className:"flex gap-3",children:a.status==="active"?e.jsx("button",{onClick:()=>p(a.id),disabled:o,className:"flex-1 py-2 px-4 bg-red-600 text-white font-semibold rounded-sm hover:bg-red-700 disabled:opacity-50 transition-all active:scale-95",children:"Suspend Account"}):a.status==="suspended"?e.jsx("button",{onClick:()=>y(a.id),disabled:o,className:"flex-1 py-2 px-4 bg-green-600 text-white font-semibold rounded-sm hover:bg-green-700 disabled:opacity-50 transition-all active:scale-95 flex items-center justify-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm"})," Reactivating..."]}):"Reactivate Account"}):e.jsx("div",{className:"flex-1 py-2 px-4 bg-gray-100 text-secondary text-center rounded-sm opacity-60",children:a.status==="closed"?"Account Closed":a.status==="frozen"?"Account Frozen":"Account Status: "+a.status})}),n===a.id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary shadow-lg max-w-md w-full p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-secondary mb-4",children:["Suspend Account ",a.account_number]}),e.jsx("p",{className:"text-sm text-secondary opacity-70 mb-4",children:"Are you sure you want to suspend this account? You will not be able to perform transactions until it is reactivated."}),e.jsx("textarea",{value:g,onChange:b=>v(b.target.value),placeholder:"Reason for suspension (required)",rows:"3",className:"w-full px-4 py-3 border border-secondary rounded-sm focus:outline-none focus:ring-2 focus:ring-basic focus:ring-opacity-30 font-sans bg-primary mb-4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{p(null),v("")},className:"flex-1 py-2 px-4 border border-secondary text-secondary font-semibold rounded-sm hover:bg-gray-50 transition-all",children:"Cancel"}),e.jsx("button",{onClick:()=>m(a.id),disabled:o||!g.trim(),className:"flex-1 py-2 px-4 bg-red-600 text-white font-semibold rounded-sm hover:bg-red-700 disabled:opacity-50 transition-all",children:"Confirm Suspension"})]})]})})]},a.id))]})},$=({profile:t,onUpdate:x,onUploadImage:u,loading:c,submitting:o,imageUploading:d})=>{const[n,p]=f.useState({full_name:t?.full_name||"",email:t?.email||"",phone_number:t?.phone_number||"",date_of_birth:t?.date_of_birth||"",nationality:t?.nationality||"",address:t?.address||"",city:t?.city||"",postal_code:t?.postal_code||"",country:t?.country||""}),[g,v]=f.useState(t?.profile_image_url||null),[h,l]=f.useState(null),[m,y]=f.useState({}),[a,b]=f.useState({type:"",text:""}),_=s=>{const{name:r,value:j}=s.target;p(N=>({...N,[r]:j})),m[r]&&y(N=>({...N,[r]:""}))},D=s=>{const r=s.target.files?.[0];if(!r)return;if(!r.type.startsWith("image/")){b({type:"error",text:"Please select a valid image file"});return}if(r.size>5*1024*1024){b({type:"error",text:"Image size must be less than 5MB"});return}const j=new FileReader;j.onloadend=()=>{l(j.result)},j.readAsDataURL(r)},E=async s=>{if(s)try{await u(s),b({type:"success",text:"Profile image updated successfully"}),l(null),setTimeout(()=>b({type:"",text:""}),3e3)}catch(r){b({type:"error",text:r?.message||"Failed to upload image"})}},F=async()=>{if(g)try{const s=g.split("/").pop();await w.storage.from("profile-images").remove([`${t?.id}/${s}`]),await w.from("user_profiles").update({profile_image_url:null}).eq("id",t?.id),v(null),l(null),b({type:"success",text:"Profile image removed successfully"}),setTimeout(()=>b({type:"",text:""}),3e3)}catch(s){b({type:"error",text:s?.message||"Failed to delete image"})}},L=()=>{const s={};return n.full_name||(s.full_name="Full name is required"),n.email||(s.email="Email is required"),n.phone_number||(s.phone_number="Phone is required"),s},i=async s=>{s.preventDefault();const r=L();if(Object.keys(r).length>0){y(r);return}await x(n),b({type:"success",text:"Profile updated successfully"}),setTimeout(()=>b({type:"",text:""}),3e3)};return c?e.jsx(S,{size:"md"}):e.jsxs("form",{onSubmit:i,className:"space-y-8",children:[a.text&&e.jsx("div",{className:`p-4 rounded-sm border-l-4 ${a.type==="success"?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800"}`,children:e.jsx("p",{className:"text-sm font-semibold",children:a.text})}),e.jsxs("div",{className:"bg-gradient-to-br from-basic to-secondary rounded-sm p-8 text-white shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:"Profile Picture"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-8",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-32 h-32 rounded-full border-4 border-white overflow-hidden bg-white bg-opacity-10 flex items-center justify-center shadow-lg",children:h||g?e.jsx("img",{src:h||g,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(I,{})})}),e.jsxs("div",{className:"flex-1 w-full sm:w-auto",children:[e.jsxs("label",{className:"block mb-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 px-6 py-4 border-2 border-dashed border-white rounded-sm cursor-pointer hover:bg-white hover:bg-opacity-10 transition-all",children:[e.jsx(M,{}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold",children:"Choose Image"}),e.jsx("p",{className:"text-xs opacity-90",children:"JPG, PNG up to 5MB"})]})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:D,disabled:d,className:"hidden"})]}),h&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>E(document.querySelector('input[type="file"]').files?.[0]),disabled:d,className:"flex-1 py-2 px-4 bg-white text-basic font-semibold rounded-sm hover:bg-opacity-90 disabled:opacity-50 transition-all flex items-center justify-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm"})," Uploading..."]}):"Save Image"}),e.jsx("button",{type:"button",onClick:()=>l(null),disabled:d,className:"flex-1 py-2 px-4 border-2 border-white text-white font-semibold rounded-sm hover:bg-white hover:bg-opacity-10 disabled:opacity-50 transition-all",children:"Cancel"})]}),g&&!h&&e.jsx("button",{type:"button",onClick:F,className:"w-full py-2 px-4 bg-red-600 text-white font-semibold rounded-sm hover:bg-red-700 transition-all",children:"Remove Current Image"})]})]})]}),e.jsxs("div",{className:"border-t border-secondary pt-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary mb-6",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsx(k,{label:"Full Name",name:"full_name",value:n.full_name,onChange:_,placeholder:"Your full name",required:!0,error:m.full_name}),e.jsx(k,{label:"Email",name:"email",type:"email",value:n.email,onChange:_,placeholder:"your@email.com",disabled:!0,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsx(k,{label:"Phone Number",name:"phone_number",value:n.phone_number,onChange:_,placeholder:"+31 6 XXXX XXXX",required:!0,error:m.phone_number}),e.jsx(k,{label:"Date of Birth",name:"date_of_birth",type:"date",value:n.date_of_birth,onChange:_,error:m.date_of_birth})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsx(k,{label:"Nationality",name:"nationality",value:n.nationality,onChange:_,placeholder:"e.g., Dutch",error:m.nationality}),e.jsx(k,{label:"Country",name:"country",value:n.country,onChange:_,placeholder:"e.g., Netherlands",error:m.country})]}),e.jsx("div",{children:e.jsx(k,{label:"Address",name:"address",value:n.address,onChange:_,placeholder:"Street address",error:m.address})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[e.jsx(k,{label:"City",name:"city",value:n.city,onChange:_,placeholder:"City",error:m.city}),e.jsx(k,{label:"Postal Code",name:"postal_code",value:n.postal_code,onChange:_,placeholder:"Postal code",error:m.postal_code})]})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full sm:w-auto py-3 px-8 bg-basic text-primary font-semibold rounded-sm hover:bg-opacity-90 disabled:opacity-50 transition-all active:scale-95 flex items-center justify-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm"})," Saving..."]}):"Save Changes"})]})},B=({profile:t,loading:x})=>{const u=t?.risk_score||0,c=d=>d<=20?"text-green-600":d<=50?"text-yellow-600":d<=75?"text-orange-600":"text-red-600",o=d=>d<=20?"Low Risk":d<=50?"Medium Risk":d<=75?"High Risk":"Critical Risk";return x?e.jsx(S,{size:"md"}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary p-8 text-center shadow-sm",children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider mb-4",children:"Current Risk Score"}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 120 120",children:[e.jsx("circle",{cx:"60",cy:"60",r:"55",fill:"none",stroke:"#e0e0e0",strokeWidth:"8"}),e.jsx("circle",{cx:"60",cy:"60",r:"55",fill:"none",stroke:u<=20?"#10b981":u<=50?"#f59e0b":u<=75?"#f97316":"#ef4444",strokeWidth:"8",strokeDasharray:`${u/100*345.6} 345.6`,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("p",{className:`text-4xl font-bold ${c(u)}`,children:u}),e.jsx("p",{className:"text-xs text-secondary opacity-60",children:"out of 100"})]})]})}),e.jsx("p",{className:`text-2xl font-bold ${c(u)} mb-2`,children:o(u)}),e.jsx("p",{className:"text-sm text-secondary opacity-70",children:u<=20?"Your account has a healthy risk profile":u<=50?"Monitor your account activity":u<=75?"Your account requires attention":"Your account is at critical risk"})]}),t?.metadata?.risk_flags&&t.metadata.risk_flags.length>0&&e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary p-6 shadow-sm",children:[e.jsx("h3",{className:"font-semibold text-secondary mb-4",children:"Risk Flags"}),e.jsx("div",{className:"space-y-2",children:t.metadata.risk_flags.map((d,n)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-red-600 mt-1",children:"⚠️"}),e.jsx("span",{className:"text-secondary",children:d})]},n))})]}),e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary p-6 shadow-sm",children:[e.jsx("h3",{className:"font-semibold text-secondary mb-4",children:"KYC Status"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-secondary opacity-70",children:"Verification Status"}),e.jsx("p",{className:`text-lg font-bold capitalize ${t?.kyc_status==="verified"?"text-green-600":t?.kyc_status==="rejected"?"text-red-600":t?.kyc_status==="suspended"?"text-orange-600":"text-yellow-600"}`,children:t?.kyc_status})]}),t?.kyc_verified_at&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-secondary opacity-70",children:"Verified At"}),e.jsx("p",{className:"text-sm font-semibold text-secondary",children:new Date(t.kyc_verified_at).toLocaleDateString()})]})]})]}),e.jsx("div",{className:"bg-blue-50 rounded-sm border border-blue-200 p-6",children:e.jsx("p",{className:"text-sm text-blue-900",children:'ℹ️ Account suspension is managed per account in the "Account Details" tab. Your KYC status determines eligibility for account features, while account status controls transaction ability.'})})]})},W=({profile:t,onUpdateAccount:x,loading:u,submitting:c})=>{const[o,d]=f.useState({metadata:t?.metadata||{},feature_flags:t?.feature_flags||{}}),[n,p]=f.useState({type:"",text:""}),g=(l,m)=>{d(y=>({...y,metadata:{...y.metadata,[l]:m}}))},v=(l,m)=>{d(y=>({...y,feature_flags:{...y.feature_flags,[l]:m==="true"}}))},h=async l=>{l.preventDefault();try{await x({metadata:o.metadata,feature_flags:o.feature_flags}),p({type:"success",text:"Account settings updated successfully"}),setTimeout(()=>p({type:"",text:""}),3e3)}catch(m){p({type:"error",text:m?.message||"Failed to update settings"})}};return u?e.jsx(S,{size:"md"}):e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[n.text&&e.jsx("div",{className:`p-4 rounded-sm border-l-4 ${n.type==="success"?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800"}`,children:e.jsx("p",{className:"text-sm font-semibold",children:n.text})}),e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary p-6 shadow-sm",children:[e.jsx("h3",{className:"font-semibold text-secondary mb-4",children:"Metadata"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{label:"Preferred Language",name:"preferred_language",value:o.metadata?.preferred_language||"",onChange:l=>g("preferred_language",l.target.value),placeholder:"e.g., en, nl, de"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-secondary mb-2 uppercase tracking-wider opacity-80",children:"Risk Flags"}),e.jsx("textarea",{value:JSON.stringify(o.metadata?.risk_flags||[],null,2),onChange:l=>{try{const m=JSON.parse(l.target.value);g("risk_flags",m)}catch{}},placeholder:'["flag1", "flag2"]',rows:"4",className:"w-full px-4 py-3 border border-secondary rounded-sm focus:outline-none focus:ring-2 focus:ring-basic focus:ring-opacity-30 font-mono bg-primary text-xs"}),e.jsx("p",{className:"text-xs text-secondary opacity-60 mt-2",children:"Enter as JSON array"})]})]})]}),e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary p-6 shadow-sm",children:[e.jsx("h3",{className:"font-semibold text-secondary mb-4",children:"Feature Flags"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-semibold text-secondary",children:"Enable Biometric"}),e.jsxs("select",{value:o.feature_flags?.enable_biometric?"true":"false",onChange:l=>v("enable_biometric",l.target.value),className:"px-3 py-2 border border-secondary rounded-sm bg-primary",children:[e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-semibold text-secondary",children:"Enable Crypto"}),e.jsxs("select",{value:o.feature_flags?.enable_crypto?"true":"false",onChange:l=>v("enable_crypto",l.target.value),className:"px-3 py-2 border border-secondary rounded-sm bg-primary",children:[e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-semibold text-secondary",children:"Enable 2FA"}),e.jsxs("select",{value:o.feature_flags?.enable_2fa?"true":"false",onChange:l=>v("enable_2fa",l.target.value),className:"px-3 py-2 border border-secondary rounded-sm bg-primary",children:[e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]})]})]})]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full sm:w-auto py-3 px-8 bg-basic text-primary font-semibold rounded-sm hover:bg-opacity-90 disabled:opacity-50 transition-all active:scale-95 flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm"})," Saving..."]}):"Save Settings"})]})};function V(){const t=U(),[x,u]=f.useState(null),[c,o]=f.useState(null),[d,n]=f.useState([]),[p,g]=f.useState(!0),[v,h]=f.useState(!1),[l,m]=f.useState(!1),[y,a]=f.useState("account");f.useEffect(()=>{let i=!0;return(async()=>{try{const{data:{session:s}={}}=await w.auth.getSession(),r=s?.user?.id;if(!r){t("/auth/login",{replace:!0});return}u(r);const{data:j,error:N}=await w.from("user_profiles").select("*").eq("id",r).eq("is_deleted",!1).maybeSingle();if(N)throw console.error("[USER_DETAILS] Profile error:",N),new Error("Failed to load profile");const{data:A,error:C}=await w.from("accounts").select("*").eq("user_id",r).eq("is_deleted",!1).order("created_at",{ascending:!1});C&&console.error("[USER_DETAILS] Accounts error:",C),i&&(o(j),n(A||[]))}catch(s){console.error("[USER_DETAILS] Load error:",s)}finally{i&&g(!1)}})(),()=>{i=!1}},[t]);const b=async i=>{h(!0);try{const{error:s}=await w.from("user_profiles").update(i).eq("id",x);if(s)throw s;o(r=>({...r,...i}))}catch(s){throw console.error("[USER_DETAILS] Update error:",s),s}finally{h(!1)}},_=async i=>{if(!(!i||!x)){m(!0);try{const s=i.name.split(".").pop(),r=`profile-${Date.now()}.${s}`,j=`${x}/${r}`,{error:N}=await w.storage.from("profile-images").upload(j,i,{upsert:!1});if(N)throw N;const{data:{publicUrl:A}}=w.storage.from("profile-images").getPublicUrl(j),{error:C}=await w.from("user_profiles").update({profile_image_url:A}).eq("id",x);if(C)throw C;o(R=>({...R,profile_image_url:A}))}catch(s){throw console.error("[USER_DETAILS] Image upload error:",s),s}finally{m(!1)}}},D=async i=>{h(!0);try{const{error:s}=await w.from("user_profiles").update(i).eq("id",x);if(s)throw s;o(r=>({...r,...i}))}catch(s){throw console.error("[USER_DETAILS] Account update error:",s),s}finally{h(!1)}},E=async(i,s)=>{h(!0);try{const{error:r}=await w.from("accounts").update({status:"suspended",metadata:{suspended_reason:s,suspended_at:new Date().toISOString()}}).eq("id",i).eq("user_id",x);if(r)throw r;n(j=>j.map(N=>N.id===i?{...N,status:"suspended",metadata:{suspended_reason:s,suspended_at:new Date().toISOString()}}:N))}catch(r){throw console.error("[USER_DETAILS] Suspend error:",r),r}finally{h(!1)}},F=async i=>{h(!0);try{const{error:s}=await w.from("accounts").update({status:"active",metadata:{reactivated_at:new Date().toISOString()}}).eq("id",i).eq("user_id",x);if(s)throw s;n(r=>r.map(j=>j.id===i?{...j,status:"active",metadata:{reactivated_at:new Date().toISOString()}}:j))}catch(s){throw console.error("[USER_DETAILS] Reactivate error:",s),s}finally{h(!1)}};if(p)return e.jsx("div",{className:"min-h-screen bg-primary flex items-center justify-center",children:e.jsx(S,{size:"lg"})});if(!x||!c)return t("/auth/login",{replace:!0}),null;const L=[{id:"account",label:"Account Details",icon:"account"},{id:"settings",label:"User Settings",icon:"settings"},{id:"risk",label:"Risk Score",icon:"risk"},{id:"status",label:"Account Status",icon:"status"}];return e.jsxs("div",{className:"min-h-screen bg-primary",children:[e.jsx(z,{profile:c,handleSignOut:()=>P(t)}),e.jsxs("main",{className:"container mx-auto max-w-6xl px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6 flex items-center gap-2 text-xs sm:text-sm text-secondary opacity-70",children:[e.jsx("button",{onClick:()=>t("/dashboard"),className:"hover:opacity-100 font-bold",children:"< Dashboard"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"font-semibold opacity-100",children:"Account Details"})]}),e.jsxs("div",{className:"mb-8 flex flex-col sm:flex-row items-center sm:items-end gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-basic to-secondary rounded-full flex items-center justify-center text-primary overflow-hidden",children:c?.profile_image_url?e.jsx("img",{src:c.profile_image_url,alt:c.full_name,className:"w-full h-full object-cover"}):e.jsx(I,{})})}),e.jsxs("div",{className:"text-center sm:text-left flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-secondary",children:c?.full_name}),e.jsx("p",{className:"text-sm text-secondary opacity-70 mt-1",children:c?.email}),e.jsxs("p",{className:"text-xs text-secondary opacity-60 mt-1",children:["ID: ",x?.substring(0,8),"..."]})]})]}),e.jsx("div",{className:"mb-8 border-b border-secondary",children:e.jsx("div",{className:"flex flex-wrap gap-2 sm:gap-1",children:L.map(i=>e.jsxs("button",{onClick:()=>a(i.id),className:`flex items-center gap-2 px-4 py-3 sm:px-6 border-b-2 transition-all font-semibold text-sm ${y===i.id?"border-basic text-basic":"border-transparent text-secondary opacity-70 hover:opacity-100"}`,children:[e.jsx(q,{name:i.icon}),e.jsx("span",{className:"hidden sm:inline",children:i.label})]},i.id))})}),e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary p-6 sm:p-8 shadow-md",children:[y==="account"&&e.jsx(T,{accounts:d,loading:p,onSuspendAccount:E,onReactivateAccount:F,submitting:v}),y==="settings"&&e.jsx($,{profile:c,onUpdate:b,onUploadImage:_,loading:p,submitting:v,imageUploading:l}),y==="risk"&&e.jsx(B,{profile:c,loading:p}),y==="status"&&e.jsx(W,{profile:c,onUpdateAccount:D,loading:p,submitting:v})]})]})]})}export{V as UserDetailsPage,V as default};
