import{u as T,r as n,s as D}from"./index-C7IEQRLs.js";import{a}from"./authService-D5WlTTbB.js";function H(){const[d,l]=n.useState(null),[f,i]=n.useState(null),[w,g]=n.useState([]),[m,o]=n.useState(!1),[y,s]=n.useState(null);n.useEffect(()=>{(async()=>{try{const e=await a.getSession();if(e?.user?.id){l(e.user);const u=await a.getUserProfile(e.user.id);i(u);const c=await a.getUserAccounts(e.user.id);g(c)}}catch(e){console.error("[USEAUTH] Init error:",e.message),s(e.message)}})();const{data:{subscription:t}}=D.auth.onAuthStateChange(async(e,u)=>{if(e==="SIGNED_OUT")l(null),i(null),g([]),s(null);else if(u?.user?.id){l(u.user);try{const c=await a.getUserProfile(u.user.id);i(c);const h=await a.getUserAccounts(u.user.id);g(h)}catch(c){console.error("[USEAUTH] State change error:",c.message),s(c.message)}}});return()=>t?.unsubscribe()},[]);const p=n.useCallback(async(r,t)=>{o(!0),s(null);try{const e=await a.signInWithAccountNumber(r,t);l(e.user);const u=await a.getUserProfile(e.user.id);i(u);const c=await a.getUserAccounts(e.user.id);return g(c),e}catch(e){throw console.error("[USEAUTH] signIn error:",e.message),s(e.message),e}finally{o(!1)}},[]),A=n.useCallback(async(r,t,e,u,c,h,P)=>{o(!0),s(null);try{return await a.signUp(r,t,e,u,c,h,P)}catch(U){throw console.error("[USEAUTH] signUp error:",U.message),s(U.message),U}finally{o(!1)}},[]),S=n.useCallback(async r=>{o(!0),s(null);try{await a.resetPasswordRequest(r)}catch(t){throw console.error("[USEAUTH] resetPasswordRequest error:",t.message),s(t.message),t}finally{o(!1)}},[]),E=n.useCallback(async r=>{o(!0),s(null);try{await a.updatePassword(r)}catch(t){throw console.error("[USEAUTH] updatePassword error:",t.message),s(t.message),t}finally{o(!1)}},[]),b=n.useCallback(async()=>{o(!0),s(null);try{await a.signOut(),l(null),i(null),g([])}catch(r){throw console.error("[USEAUTH] signOut error:",r.message),s(r.message),r}finally{o(!1)}},[]);return{user:d,profile:f,accounts:w,loading:m,error:y,signIn:p,signUp:A,resetPasswordRequest:S,updatePassword:E,signOut:b}}function I(d){const{user:l,loading:f}=H(),i=T();n.useEffect(()=>{f||l&&i("/dashboard",{replace:!0})},[d,l,f,i])}export{H as a,I as u};
