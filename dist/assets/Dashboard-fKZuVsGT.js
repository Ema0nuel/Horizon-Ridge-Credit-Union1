import{u as L,r as x,s as o,j as e,a as S,b as y}from"./index-C7IEQRLs.js";import{U as A}from"./UserHeader-K6QWOYdA.js";const C=({name:a})=>({"Send Money":e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8m0 8l-4-2m4 2l4-2"})}),"Add Money":e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Buy Airtime":e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Bank Details":e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"})}),"Bank Statement":e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Tax Refund":e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),Loan:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),Cards:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h4m4 0h4M5 21h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z"})})})[a]||null,B=({title:a,route:m,onClick:u})=>e.jsxs(y,{to:m,onClick:u,className:"flex flex-col items-center gap-3 p-4 sm:p-6 rounded-sm border border-secondary bg-primary hover:bg-gray-50 hover:shadow-md transition-all active:scale-95 group","aria-label":a,children:[e.jsx("div",{className:"text-basic group-hover:text-secondary transition-colors",children:e.jsx(C,{name:a})}),e.jsx("p",{className:"text-xs sm:text-sm font-semibold text-secondary text-center",children:a})]});function _(){const a=L(),[m,u]=x.useState(null),[p,f]=x.useState(null),[l,g]=x.useState([]),[N,h]=x.useState(!0);x.useEffect(()=>{let s=!0,c=null,d=null;async function j(n){try{h(!0);const{data:r,error:b}=await o.from("user_profiles").select("*").eq("id",n).eq("is_deleted",!1).maybeSingle();b&&console.error("[DASHBOARD] profile fetch error:",b);const{data:v,error:i}=await o.from("accounts").select("*").eq("user_id",n).eq("is_deleted",!1).order("created_at",{ascending:!1});if(i&&console.error("[DASHBOARD] accounts fetch error:",i),!s)return;f(r||null),g(v||[])}catch(r){console.error("[DASHBOARD] loadDataForUser error:",r)}finally{s&&h(!1)}}return(async()=>{try{const{data:{session:n}={}}=await o.auth.getSession(),r=n?.user?.id||null;u(r),r?(await j(r),c=o.channel(`accounts:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"accounts",filter:`user_id=eq.${r}`},b=>{j(r)}).subscribe()):h(!1),d=o.auth.onAuthStateChange((b,v)=>{const i=v?.user?.id||null;u(i),i?j(i):(f(null),g([]))})}catch(n){console.error("[DASHBOARD] initial load error:",n),s&&h(!1)}})(),()=>{s=!1;try{c&&(c.unsubscribe?.(),o.removeChannel?.(c)),d?.subscription?.unsubscribe?d.subscription.unsubscribe():d?.unsubscribe&&d.unsubscribe()}catch{}}},[]);const k=async()=>{try{const{error:s}=await o.auth.signOut();s&&console.error("[DASHBOARD] signOut error:",s),f(null),g([]),a("/auth/login",{replace:!0})}catch(s){console.error("[DASHBOARD] signOut exception:",s)}};if(N)return e.jsx("div",{className:"min-h-screen bg-primary flex items-center justify-center",children:e.jsx(S,{size:"lg"})});if(!m)return a("/auth/login",{replace:!0}),null;const t=l&&l.length>0?l[0]:null,w=[{title:"Send Money",route:"/transfer"},{title:"Add Money",route:"/add-money"},{title:"Buy Airtime",route:"/buy-airtime"},{title:"Bank Details",route:"/account-details"},{title:"Bank Statement",route:"/statements"},{title:"Tax Refund",route:"/tax-refund"},{title:"Loan",route:"/loan"},{title:"Cards",route:"/cards"}];return e.jsxs("div",{className:"min-h-screen bg-primary",children:[e.jsx(A,{handleSignOut:k,profile:p}),e.jsxs("main",{className:"container mx-auto max-w-6xl px-4 py-6 sm:py-8",children:[p?.kyc_status!=="verified"&&e.jsx("div",{className:"mb-6 sm:mb-8 p-4 sm:p-6 bg-yellow-50 border-l-4 border-yellow-500 rounded-sm shadow-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-yellow-900 mb-2 text-base sm:text-lg",children:"⚠️ Complete KYC Verification"}),e.jsx("p",{className:"text-xs sm:text-sm text-yellow-800 opacity-90",children:"To unlock full functionality including transfers and higher limits, please complete your Know Your Customer (KYC) verification."})]}),e.jsx(y,{to:"/dashboard/kyc",className:"mt-2 sm:mt-0 py-2 px-6 bg-yellow-600 text-white font-semibold rounded-sm text-sm hover:bg-yellow-700 transition-all whitespace-nowrap active:scale-95",children:"Start KYC"})]})}),t&&e.jsxs("div",{className:"mt-6 sm:mt-12 grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary p-4 sm:p-6 text-center",children:[e.jsx("p",{className:"text-xs sm:text-sm text-secondary opacity-70 mb-2",children:"Total Accounts"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-basic",children:l.length})]}),e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary p-4 sm:p-6 text-center",children:[e.jsx("p",{className:"text-xs sm:text-sm text-secondary opacity-70 mb-2",children:"Balance"}),e.jsxs("p",{className:"text-2xl sm:text-3xl font-bold text-basic",children:["$",l.reduce((s,c)=>s+parseFloat(c.balance||0),0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-primary rounded-sm border border-secondary p-4 sm:p-6 text-center",children:[e.jsx("p",{className:"text-xs sm:text-sm text-secondary opacity-70 mb-2",children:"KYC Status"}),e.jsx("p",{className:`text-base sm:text-lg font-semibold capitalize ${p?.kyc_status==="verified"?"text-green-600":"text-yellow-600"}`,children:p?.kyc_status||"Pending"})]})]}),e.jsxs("div",{className:"mt-8 sm:mt-12",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-secondary mb-6",children:"Your Accounts & Quick Links"}),t?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-primary rounded-sm border border-secondary shadow-lg hover:shadow-xl transition-shadow p-6",children:[e.jsxs("div",{className:"mb-6 pb-6 border-b border-secondary",children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Account Number"}),e.jsx("p",{className:"text-2xl font-bold text-secondary font-mono mt-2",children:t.account_number})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Type"}),e.jsx("p",{className:"font-semibold text-secondary capitalize mt-1 text-sm",children:t.account_type==="savings"?"Savings":"Checking"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Currency"}),e.jsx("p",{className:"font-semibold text-secondary mt-1 text-sm",children:t.currency})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Status"}),e.jsx("p",{className:`${t.status==="active"?"text-green-600":"text-red-500"} font-semibold mt-1 capitalize text-sm`,children:t.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Created"}),e.jsx("p",{className:"font-semibold text-secondary mt-1 text-xs",children:new Date(t.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"mb-6 pb-6 border-t border-secondary pt-6",children:[e.jsx("p",{className:"text-xs text-secondary opacity-60 uppercase tracking-wider",children:"Available Balance"}),e.jsxs("p",{className:"text-3xl font-bold text-basic mt-2",children:[t.currency," ",parseFloat(t.available_balance||t.balance||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(y,{to:"/transfer",className:"w-full py-2 px-4 bg-basic text-primary font-semibold rounded-sm text-sm hover:bg-opacity-90 transition-all active:scale-95 text-center","aria-label":`Transfer from account ${t.account_number}`,children:"Transfer"}),e.jsx(y,{to:"/account-details",className:"w-full py-2 px-4 border border-secondary text-secondary font-semibold rounded-sm text-sm hover:bg-gray-50 transition-all active:scale-95 text-center","aria-label":`View details for account ${t.account_number}`,children:"Details"})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4",children:w.map(s=>e.jsx(B,{title:s.title,route:s.route},s.title))})})]}):e.jsxs("div",{className:"text-center py-16 bg-gray-50 rounded-sm border border-secondary",children:[e.jsx("p",{className:"text-lg text-secondary opacity-70 mb-4",children:"No accounts found"}),e.jsx("p",{className:"text-sm text-secondary opacity-50",children:"Contact support to create your first account"})]})]})]})]})}export{_ as DashboardPage};
